#!/bin/bash
# This script will be used to run unit tests.

BASEDIR=$(dirname $(dirname "$0"))

# pep8 has been moved to pycodestyle, but pytest-pep8 has been
# inactive for one year. So we have to use them in parallel.
py.test "$BASEDIR"/tests \
    --pep8 "$BASEDIR"/imagebutler \
    --cov "$BASEDIR"/imagebutler \
    --cov-report term-missing

if [ $? -gt 0 ]; then exit 1; fi

echo "================"
echo "PEP8 violations:"
echo "================"
pycodestyle --first "$BASEDIR"/imagebutler
echo "================"
echo "End of PEP8./."; echo ""
echo "================"
echo "Bandit check:"
echo "================"
bandit -r "$BASEDIR"/imagebutler
echo "================"
echo "Document link check:"
echo "================"
cd docs && make linkcheck
echo "================"
echo "End of Document link check./."; echo ""
